<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Health Tips</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='image/healthtips.png') }}">

</head>


<body>
    <header class="main-header">
        <!-- Logo and Title -->
        <div class="logo-section">
            <img src="{{ url_for('static', filename='image/healthtips.png') }}" alt="ABDULmaliki Health Tips Logo" class="site-logo">
            <h1 class="app-title">ABDULmaliki Health Tips</h1>
        </div>
            <div class="header-icons">
        <!-- Theme Toggle -->
        <button id="theme-toggle"><i class="fas fa-adjust"></i></button>

        <!-- If user is not logged in -->
        {% if not session.get('user_id') %}
    <!-- Not logged in -->
    <a href="{{ url_for('signup') }}" class="btn-signup">
        <i class="fas fa-user-plus"></i> Sign Up
    </a>
    <a href="{{ url_for('login') }}" class="btn-login">
        <i class="fas fa-sign-in-alt"></i> Log In
    </a>
{% else %}
    <!-- Logged in -->
    <a href="{{ url_for('profile', user_id=session['user_id']) }}" class="btn-profile">
        <i class="fas fa-user"></i> {{ session['user_id'] }}
    </a>
    <a href="{{ url_for('logout') }}" class="btn-logout">
        <i class="fas fa-sign-out-alt"></i> Log Out
    </a>
{% endif %}

    </div>
        <!-- Search Bar -->
        <div class="search-section">
            <input type="text" id="search-bar" placeholder="Search health tips..." oninput="filterTips()">
            <button onclick="filterTips()" class="search-btn"><i class="fas fa-search"></i></button>
        </div>

        <!-- Header Icons -->
        <div class="header-icons">
            <button id="theme-toggle"><i class="fas fa-adjust"></i></button>
            <button><i class="fas fa-user"></i></button>
        </div>
    </header>

    <!-- Admin Upload Form -->
    <div class="upload-section">
        <h2>üì§ Add New Health Tip</h2>
        <form id="upload-form" enctype="multipart/form-data">
            <textarea name="content" id="tip-content" placeholder="Enter your health tip..." required></textarea>
            <input type="file" name="image" accept="image/*">
            <input type="file" name="video" accept="video/*">
            <button type="submit"><i class="fas fa-upload"></i> Upload Tip</button>
        </form>
    </div>

    <hr>

    <!-- Tips Feed -->
    <div id="tips-container"></div>
    
    <!-- FAQ Section -->
    <section class="faq-section">
        <h2 class="faq-title">‚ùì Frequently Asked Questions</h2>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span>What is ABDULmaliki Health Tips about?</span>
                <i class="fas fa-plus"></i>
            </div>
            <div class="faq-answer">
                Our site provides reliable health tips, articles, and videos to help people live healthier lives. You can search, like, share, and download content easily.
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span>How can I upload a health tip?</span>
                <i class="fas fa-plus"></i>
            </div>
            <div class="faq-answer">
                If you are an admin, you can upload tips with images or videos using the upload form. Simply type your tip, choose media files, and click the upload button.
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span>Can I like, comment, and share tips?</span>
                <i class="fas fa-plus"></i>
            </div>
            <div class="faq-answer">
                Yes! You can like tips, share them directly to your device or apps, and soon you‚Äôll be able to leave comments to join the discussion.
            </div>
        </div>

        <div class="faq-item">
            <div class="faq-question" onclick="toggleFAQ(this)">
                <span>Do I need an account to use the site?</span>
                <i class="fas fa-plus"></i>
            </div>
            <div class="faq-answer">
                Currently, you don‚Äôt need an account to view and interact with tips, but account features may be added in the future for a more personalized experience.
            </div>
        </div>
    </section>

    <script>
        let allTips = [];

        async function loadTips() {
            let res = await fetch('/tips');
            allTips = await res.json();
            renderTips(allTips);
        }

        function renderTips(tips) {
            let container = document.getElementById('tips-container');
            container.innerHTML = '';
            tips.forEach(t => {
                container.innerHTML += `
                    <div class="tip-card">
                        ${t.image_url ? `<img src="${t.image_url}" class="tip-image">` : ''}
                        ${t.video_url ? `<video class="tip-video" controls><source src="${t.video_url}" type="video/mp4"></video>` : ''}
                        <p class="tip-content">${t.content}</p>
                        <div class="tip-actions">
                            <button onclick="likeTip(${t.id})"><i class="fas fa-thumbs-up"></i> ${t.likes}</button>
                            <button onclick="alert('Comment feature coming soon!')"><i class="fas fa-comment"></i></button>
                            <button onclick="shareTip('${t.content}')"><i class="fas fa-share-alt"></i></button>
                            <button onclick="downloadTip('${t.content}')"><i class="fas fa-download"></i></button>
                        </div>
                    </div>
                `;
            });
        }

        async function likeTip(id) {
            await fetch('/like/' + id, { method: 'POST' });
            loadTips();
        }

        function shareTip(content) {
            if (navigator.share) {
                navigator.share({ title: 'Health Tip', text: content });
            } else {
                alert("Sharing not supported on this browser.");
            }
        }

        function downloadTip(content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'health_tip.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        document.getElementById('upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            let formData = new FormData(document.getElementById('upload-form'));
            let res = await fetch('/add_tip', { method: 'POST', body: formData });
            let data = await res.json();
            alert(data.message);
            document.getElementById('upload-form').reset();
            loadTips();
        });

        function filterTips() {
            let query = document.getElementById('search-bar').value.toLowerCase();
            let filtered = allTips.filter(t => t.content.toLowerCase().includes(query));
            renderTips(filtered);
        }

        function toggleFAQ(element) {
            const answer = element.nextElementSibling;
            const icon = element.querySelector('i');
            if (answer.style.display === "block") {
                answer.style.display = "none";
                icon.classList.remove("fa-minus");
                icon.classList.add("fa-plus");
            } else {
                answer.style.display = "block";
                icon.classList.remove("fa-plus");
                icon.classList.add("fa-minus");
            }
        }

        loadTips();
    </script>
</body>
</html>
